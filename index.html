<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@spinfi/core</title><meta name="description" content="Documentation for @spinfi/core"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@spinfi/core</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@spinfi/core </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#links" id="links" style="color: inherit; text-decoration: none;">
  <h1>Links</h1>
</a>
<ul>
<li><p><a href="https://docs.api.spin.fi/#introduction"><strong>Contract api</strong></a></p>
</li>
<li><p><a href="https://spin-fi.github.io/near-dex-core-js/"><strong>JS api</strong></a></p>
</li>
<li><p><a href="https://github.com/spin-fi/near-dex-core-js"><strong>@spinfi/core</strong></a></p>
</li>
<li><p><a href="https://github.com/spin-fi/near-dex-node-js"><strong>@spinfi/node</strong></a></p>
</li>
</ul>

<a href="#spinfinode" id="spinfinode" style="color: inherit; text-decoration: none;">
  <h1>@spinfi/node</h1>
</a>
<p>Spin node create spin api for node</p>

<a href="#how-to-install" id="how-to-install" style="color: inherit; text-decoration: none;">
  <h3>How to install</h3>
</a>
<pre><code class="language-bash"><span class="hl-0">yarn add @spinfi/node</span>
</code></pre>

<a href="#how-to-init" id="how-to-init" style="color: inherit; text-decoration: none;">
  <h3>How to init</h3>
</a>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> {</span><span class="hl-2">spin</span><span class="hl-0">} = </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-4">createApi</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-5">accountId:</span><span class="hl-0"> </span><span class="hl-6">&#39;some account id value&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-5">privateKey:</span><span class="hl-0"> </span><span class="hl-6">&#39;some private key value&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#spinficore" id="spinficore" style="color: inherit; text-decoration: none;">
  <h1>@spinfi/core</h1>
</a>
<p>Spin core create spin api instace that work exactly in browser and node.js</p>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">response</span><span class="hl-0"> = </span><span class="hl-3">await</span><span class="hl-0"> </span><span class="hl-5">spin</span><span class="hl-0">.</span><span class="hl-4">depositFt</span><span class="hl-0">(</span><span class="hl-5">request</span><span class="hl-0">);</span>
</code></pre>

<a href="#websocket" id="websocket" style="color: inherit; text-decoration: none;">
  <h2>Websocket</h2>
</a>
<p>Websocket property provide functions to call <code>spin</code> off-chain methods by websocket</p>
<p>Websocket method divided in two types:</p>
<ul>
<li>method (similar to async call with callback)</li>
<li>subscription</li>
</ul>

<a href="#1-method" id="1-method" style="color: inherit; text-decoration: none;">
  <h3>1. Method</h3>
</a>
<p>Method require some parameters in <code>json rpc</code> format and return some data with <code>onOk</code> callback.
If websocket return not expected data format - api will ignore it. If websocket return correct
message without connection/js error, but with error field - data handled by <code>onError</code> callback</p>

<a href="#how-to-use" id="how-to-use" style="color: inherit; text-decoration: none;">
  <h3>How to use</h3>
</a>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">unsubscribe</span><span class="hl-0"> = </span><span class="hl-5">spin</span><span class="hl-0">.</span><span class="hl-4">ping</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-4">onOk</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">});</span>
</code></pre>

<a href="#2-subscription" id="2-subscription" style="color: inherit; text-decoration: none;">
  <h3>2. Subscription</h3>
</a>
<p>Subscription its like method but more complex. It work like that:</p>
<ul>
<li>subscription send method <code>sub</code> and create <code>channel</code> to server</li>
<li>if <code>sub</code> ok (channel created) then api create listners for websocket</li>
<li>if new websocket message its for <code>channel</code> then api call corresponding subscription callbacks</li>
</ul>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">unsubscribe</span><span class="hl-0"> = </span><span class="hl-5">spin</span><span class="hl-0">.</span><span class="hl-4">listenOrders</span><span class="hl-0">(</span><span class="hl-5">request</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-4">onSubOk</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onSubError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">});</span>
</code></pre>
<p>Channel - its stream of websocket message that have same <code>subscription id</code> and have some format.
Messages in channel maybe different. Some channel have first uniq message and some not.
First uniq message in channel its <code>state</code> and other messages its <code>notification</code></p>
<p>Websoket message match with channel by <code>json rpc</code> id created when subscription called and <code>subscription id</code>
created by server</p>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">unsubscribe</span><span class="hl-0"> = </span><span class="hl-5">spin</span><span class="hl-0">.</span><span class="hl-4">listenOrders</span><span class="hl-0">(</span><span class="hl-5">request</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-4">onNotifyOk</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onNotifyError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onStateOk</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onStateError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">});</span>
</code></pre>
<p>Some times its needed unsubscribe from subscription. It work like that:</p>
<ul>
<li>subscription send method <code>unsub</code> and get response</li>
<li>if response is <code>true</code> then <code>channel</code> is closed</li>
<li>internal <code>rxjs</code> subscriptions its also unsubscribed</li>
<li>if response is <code>false</code> then <code>channel</code> not closed</li>
<li><code>onUnsubError</code> handle <code>false</code> branch</li>
</ul>
<pre><code class="language-js"><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-2">unsubscribe</span><span class="hl-0"> = </span><span class="hl-5">spin</span><span class="hl-0">.</span><span class="hl-4">listenOrders</span><span class="hl-0">(</span><span class="hl-5">request</span><span class="hl-0">, {</span><br/><span class="hl-0">  </span><span class="hl-4">onSubError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">  </span><span class="hl-4">onUnsubError</span><span class="hl-5">:</span><span class="hl-0"> (</span><span class="hl-5">error</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-4">error</span><span class="hl-0">(</span><span class="hl-5">error</span><span class="hl-0">),</span><br/><span class="hl-0">});</span>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class="label tsd-is-external"><span>Internals</span></li><li class=" tsd-kind-namespace"><a href="modules/perp.html">perp</a></li><li class=" tsd-kind-namespace"><a href="modules/perpBundler.html">perp<wbr/>Bundler</a></li><li class=" tsd-kind-namespace"><a href="modules/spot.html">spot</a></li><li class=" tsd-kind-namespace"><a href="modules/spotBundler.html">spot<wbr/>Bundler</a></li><li class="label tsd-is-external"><span>Externals</span></li><li class=" tsd-kind-namespace tsd-is-external"><a href="modules/websocket.html">websocket</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum tsd-is-external"><a href="enums/ExecutionStatusBasic.html" class="tsd-kind-icon">Execution<wbr/>Status<wbr/>Basic</a></li><li class="tsd-kind-enum tsd-is-external"><a href="enums/FinalExecutionStatusBasic.html" class="tsd-kind-icon">Final<wbr/>Execution<wbr/>Status<wbr/>Basic</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/Account.html" class="tsd-kind-icon">Account</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/Action.html" class="tsd-kind-icon">Action</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/SignedTransaction.html" class="tsd-kind-icon">Signed<wbr/>Transaction</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/Subscription.html" class="tsd-kind-icon">Subscription</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/Transaction.html" class="tsd-kind-icon">Transaction</a></li><li class="tsd-kind-class tsd-is-external"><a href="classes/WalletConnection.html" class="tsd-kind-icon">Wallet<wbr/>Connection</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/AccountBalance.html" class="tsd-kind-icon">Account<wbr/>Balance</a></li><li class="tsd-kind-interface"><a href="interfaces/BundlerCoreParams.html" class="tsd-kind-icon">Bundler<wbr/>Core<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreAction.html" class="tsd-kind-icon">Core<wbr/>Action</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreConfig.html" class="tsd-kind-icon">Core<wbr/>Config</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreNear.html" class="tsd-kind-icon">Core<wbr/>Near</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreParams.html" class="tsd-kind-icon">Core<wbr/>Params</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreParamsTransactions.html" class="tsd-kind-icon">Core<wbr/>Params<wbr/>Transactions</a></li><li class="tsd-kind-interface"><a href="interfaces/CoreSelector.html" class="tsd-kind-icon">Core<wbr/>Selector</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/ExecutionError.html" class="tsd-kind-icon">Execution<wbr/>Error</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/ExecutionOutcome.html" class="tsd-kind-icon">Execution<wbr/>Outcome</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/ExecutionOutcomeWithId.html" class="tsd-kind-icon">Execution<wbr/>Outcome<wbr/>With<wbr/>Id</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/ExecutionStatus.html" class="tsd-kind-icon">Execution<wbr/>Status</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/FinalExecutionOutcome.html" class="tsd-kind-icon">Final<wbr/>Execution<wbr/>Outcome</a></li><li class="tsd-kind-interface tsd-is-external"><a href="interfaces/FinalExecutionStatus.html" class="tsd-kind-icon">Final<wbr/>Execution<wbr/>Status</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>